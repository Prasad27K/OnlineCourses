<!-- Syllubas Items -->
<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Add Syllabus</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
<!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous"> -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<link rel="stylesheet" href="OnlineCourses.css"></link>
</head>
<body>
	<div id="mainCard">
		<div id="header"><button id="addCourse" class="btn btn-info" onclick="addCourse()">Add Course</button></div>
		<div id="card" class="include"></div>
	</div>
</body>
<script type="text/javascript">

	var syllabusItems = [];
	var courseData = {};
	
	function createForm(index, obj)
	{
		let addCourseForm = `<div id="addCourseForm${index}" class="addCourseForm">
			<label class="syllabusNumber">Syllabus${index + 1}</label>
			<fieldset class="scheduler-border">
			<legend >Syllabus Title</legend>
			<input id="title${index}" class="input-field" type="text" value="${obj.Title}" name="title${index}" placeholder="Syllabus-title">
			<br>`;
			if(!obj.isTitleValid)
			{
				addCourseForm += `<label id="titleError" class="errorMesssage">Please enter Syllabus-title</label>`;
			}
			addCourseForm += `</fieldset>
			<fieldset>
			<legend>Syllabus description</legend>
			<input id="description${index}" class="input-field" type="text" value="${obj.Description}" name="description${index}" placeholder="Syllabus description ">
			<br>`;
			if(!obj.isDescreptionValid)
			{
				addCourseForm += `<label id="descriptionError" class="errorMesssage">Please enter Syllabus-description</label>`;
			}
			addCourseForm += `</fieldset>
			<fieldset>
			<legend>Learning objective</legend>
			<input id="objective${index}" class="input-field" type="text" value="${obj.Objective}" name="objective${index}" placeholder="Syllabus objective">
			<br>`;
			if(!obj.isObjectiveValid)
			{
				addCourseForm += `<label id="objectiveError" class="errorMesssage">Please enter Syllabus-objective</label>`;
			}
			addCourseForm += `</fieldset>
			<button id="saveCourse" class="btn btn-info" onclick="save(${index})">Save</button>
			<button id="cancel" class="btn btn-info" onclick="cancel(${index})">Cancel</button>
			</div>`;
		return addCourseForm;
	}

	function addCourse()
	{
		const emptyObject = {Title: "", Description: "", Objective: "", EditMode: true, isTitleValid: true, isDescreptionValid: true, isObjectiveValid: true};
		syllabusItems.push(emptyObject);
		reRender(syllabusItems);
	}

	function cancel(index)
	{
		const obj = syllabusItems[index];
		if((obj.Title == "") && (obj.Description == "") && (obj.Objective  == ""))
		{
			syllabusItems.splice(index, 1);
		}
		obj.EditMode = false;
		reRender(syllabusItems);
	}
	
	function save(index)
	{
		if(formValidation(index))
		{				
			courseData = {};
			courseData = {Title: $(`#title${index}`).val(), Description: $(`#description${index}`).val(), Objective: $(`#objective${index}`).val(), EditMode: false, isTitleValid: true, isDescreptionValid: true, isObjectiveValid: true};
			syllabusItems[index] = courseData;
		}
		reRender(syllabusItems);
	}

	function reRender(syllabusItems)
	{
		$(".include").html("");
		let index = 0;
		for( const obj of syllabusItems)
		{
			if(obj.EditMode == false)
			{
	
				var HTMLElement = createCard(index, obj)
			}
			else
			{
				var HTMLElement = createForm(index, obj)
			}
			$(".include").append(HTMLElement);
			index++;
		}
	}

	function createCard(index, obj)
	{
		const card = `<div class="contents">
				<label class="index" id="index">${(index + 1)}</label>
				<label class="cardContent">${obj.Title}<br>${obj.Description}</label> 
				<a href="#" id="delete" onclick="deleteCourse(${index})"><span class='glyphicon glyphicon-trash'></a>
				<a href="#" id="edit${index}" onclick="edit(${index})"><span class='glyphicon glyphicon-edit'></span></a>
				</div>`;
		return card;
	}

	function deleteCourse(index)
	{
		const ok = confirm("Are you sure to Delete?");
		if(ok)
		{
			syllabusItems.splice(index, 1);
			reRender(syllabusItems);
		}
	}

	function edit(index)
	{
		const obj = syllabusItems[index];
		obj.EditMode = true;
		reRender(syllabusItems);	
	}

	function formValidation(index)
	{
		const obj = syllabusItems[index];
		var isValid = true;
		if($(`#title${index}`).val() == "")
		{
			obj.isTitleValid = false;
			isValid = false;
		}

		if($(`#description${index}`).val() == "")
		{
			obj.isDescreptionValid = false;
			isValid = false;
		}
		
		if($(`#objective${index}`).val() == "")
		{
			obj.isObjectiveValid = false;
			isValid = false;
		}
		return ((!isValid) ? false : true);
	}

</script>
</html>